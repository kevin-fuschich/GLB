<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GLB</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    h1 { margin: 0 0 12px 0; }
    .status { padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; margin: 12px 0 18px 0; }
    .ok { background: #f3fff3; border-color: #bfe6bf; }
    .bad { background: #fff3f3; border-color: #e6bfbf; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; white-space: pre-wrap; }
    table { border-collapse: collapse; width: 100%; margin: 10px 0 18px 0; }
    th, td { border-bottom: 1px solid #eee; padding: 8px 6px; text-align: left; }
    .small { color: #666; font-size: 13px; }
  </style>
</head>
<body>
  <h1>GLB</h1>

  <div id="status" class="status">
    <div><strong>Status:</strong> <span id="statusText">Loading…</span></div>
    <div class="small">This page will tell us exactly which file fails to load.</div>
  </div>

  <div id="debug" class="mono"></div>

  <h2>Daily Scores</h2>
  <div id="scores"></div>

  <h2>Standings</h2>
  <div id="standings"></div>

  <h2>Leaders</h2>
  <div id="leaders"></div>

<script>
  const DAY_PATH = "data/days/2026-04-08.json";
  const STANDINGS_PATH = "current/standings.json";
  const LEADERS_PATH = "current/leaders.json";

  const $ = (id) => document.getElementById(id);
  function log(line) { $("debug").textContent += line + "\n"; }
  function setStatus(text, ok=true) {
    $("statusText").textContent = text;
    $("status").className = "status " + (ok ? "ok" : "bad");
  }

  async function loadJson(path) {
    const url = path + "?v=" + Date.now();
    log("Fetching: " + url);
    const res = await fetch(url, { cache: "no-store" });
    log("→ HTTP " + res.status + " " + path);
    if (!res.ok) throw new Error("Fetch failed (" + res.status + "): " + path);
    return res.json();
  }

  function renderScores(day) {
    if (!day || !day.games) return "<div class='small'>No games.</div>";
    const rows = day.games.map(g =>
      `<tr>
        <td>${g.away_team}</td><td>${g.away_score}</td>
        <td>@</td>
        <td>${g.home_team}</td><td>${g.home_score}</td>
      </tr>`
    ).join("");
    return `
      <div class="small">${day.label} — ${day.status}</div>
      <table>
        <thead><tr><th>Away</th><th></th><th></th><th>Home</th><th></th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
    `;
  }

  function renderStandings(s) {
    if (!s || !s.divisions) return "<div class='small'>No standings.</div>";
    const divHtml = Object.entries(s.divisions).map(([div, teams]) => {
      const rows = (teams || []).map(t =>
        `<tr>
          <td>${t.team}</td><td>${t.w}-${t.l}</td><td>${t.pct}</td><td>${t.gb}</td><td>${t.diff}</td>
        </tr>`
      ).join("");
      return `
        <div class="small"><strong>${div}</strong> (as of ${s.as_of})</div>
        <table>
          <thead><tr><th>Team</th><th>W-L</th><th>PCT</th><th>GB</th><th>DIFF</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }).join("");
    return divHtml;
  }

  function renderLeaders(l) {
    if (!l) return "<div class='small'>No leaders.</div>";
    const sections = [];
    if (l.batting) sections.push(["Batting", l.batting]);
    if (l.pitching) sections.push(["Pitching", l.pitching]);

    const html = sections.map(([title, cats]) => {
      const catHtml = Object.entries(cats).map(([cat, arr]) => {
        const rows = (arr || []).map(x =>
          `<tr><td>${x.player}</td><td>${x.team}</td><td>${x.value}</td></tr>`
        ).join("");
        return `
          <div class="small"><strong>${cat}</strong></div>
          <table>
            <thead><tr><th>Player</th><th>Team</th><th>Value</th></tr></thead>
            <tbody>${rows}</tbody>
          </table>
        `;
      }).join("");
      return `<h3>${title}</h3>${catHtml}`;
    }).join("");
    return `<div class="small">As of ${l.as_of}</div>` + html;
  }

  (async function main() {
    try {
      setStatus("Loading day file…", true);
      const day = await loadJson(DAY_PATH);
      $("scores").innerHTML = renderScores(day);

      setStatus("Loading standings…", true);
      const standings = await loadJson(STANDINGS_PATH);
      $("standings").innerHTML = renderStandings(standings);

      setStatus("Loading leaders…", true);
      const leaders = await loadJson(LEADERS_PATH);
      $("leaders").innerHTML = renderLeaders(leaders);

      setStatus("Loaded.", true);
      log("DONE ✅");
    } catch (err) {
      setStatus("Load failed.", false);
      log("ERROR ❌ " + (err && err.message ? err.message : err));
    }
  })();
</script>
</body>
</html>
